### getAttr로 afterLoginUri가 없는 경우 해결, 로그아웃 후 다시 원래 페이지로 이동(로그인을 필요로 한다면 메인페이지로 이동)

**1\) getAttr로 afterLoginUri가 없는 경우**

```java
public String getAfterLoginUri() {
		String requestUri = req.getRequestURI();
		switch (requestUri) {
		case "/usr/member/login":
		case "/usr/member/join":
		case "/usr/member/findLoginId":
		case "/usr/member/findLoginPw":
			return Ut.getUriEncoded(Ut.getAttr(paramMap, "afterLoginUri", ""));
		}
		return getEncodedCurrentUri();
	}
```

- ```/usr/member/login``` 으로 요청시 파라미터 afterLoginUri의 값이 ```null```이므로 
- 로그인페이지의 상단 로그인버튼의 이동 경로(```href="${rq.loginUri}"```) 를 지정할수 없는 문제발생
- ```${rq.loginUri}```는 로그인후 이동할 uri를 인코딩한 반환값을 더하고 있으므로
- 로그인후 이동할페이지(afterLoginUri)의 값이 null이므로 인코딩 시(```Ut.getUriEncoded()```) NullPointException 발생
- 즉, uri요청시 파라미터의 키와 밸류를 paramMap으로 저장했으므로 
- afterLoginUri가 없을경우 paramMap에는 저장되있지 않는다.
- 인코딩시(Ut.getUriEncoded()) NullPointException발생 이를 해결하기위해
- Ut.getAttr() 메소드 적용

**2\) Ut.getAttr()**

```java
    public static String getAttr(Map map, String attrName, String defaultValue) {
        if(map.containsKey(attrName)) {
            return (String)map.get(attrName);
        }
        return defaultValue;
    }
```

- map에서 ```attrName``` 키가 존재하지 않는다면
- defaultValue 값을 반환 
- 있다면 키에 대한 밸류값을 반환

**3\) 로그아웃 후 다시 원래 페이지로 이동**

```java
    public String getAfterLogoutUri() {
            String requestUri = req.getRequestURI();
            switch (requestUri) {
            case "/usr/article/write":
            case "/usr/article/modify":
            case "/usr/member/myPage":
                return Ut.getUriEncoded("/");
            }
            return getEncodedCurrentUri();
        }
```

- 로그인 후 원래 페이지로 이동하는 방식이 동일

- 로그아웃 페이지로 이동할때 현재 페이지의 uri를 함께 전달한다.

- 이때 현재 페이지(```req.getRequestURI()```)가 로그아웃 후 이동 되면 안되는 uri이면 ```/``` 로 이동

- write / modify / myPage는 로그인이 필요한 페이지 이므로 ```/``` 이동 시킴

  

